# Документация модуля: autorization/app.py

## Что должен делать код в общих чертах
Приложение предоставляет минимальный веб-интерфейс для входа в систему и отображения закрытой страницы. Пользователь вводит учётные данные, после чего модуль отправляет запрос в сервис "Мой Склад" и при успешном ответе сохраняет логин в сессии. Наличие записи в сессии используется для проверки доступа к рабочей странице. Код предназначен только для демонстрационных целей и не хранит данные между перезапусками.

## Последовательность действий в коде
1) Создаётся объект `Flask` и настраивается `ProxyFix`.
2) Определяется декоратор `login_required` для проверки сессии.
3) Реализуются представления: `index`, `login`, `logout`, `work`.
4) В `login` обрабатывается форма, выполняется HTTP-запрос к `MY_SKLAD_URL` и при успехе в сессию записывается имя пользователя.
5) `logout` очищает сессию и перенаправляет на страницу входа.
6) `work` доступна только авторизованным пользователям и возвращает HTML-шаблон рабочей области.

## Карта глобальных переменных
| Имя | Тип | Значение по умолчанию | Экспортируется | Назначение | Используется в |
|---|---|---|:---:|---|---|
| `app` | Flask | `Flask(__name__)` | да | Основной объект приложения | тесты, точки входа |
| `MY_SKLAD_URL` | str | `'https://api.moysklad.ru/api/remap/1.2/context/usersettings'` | нет | Эндпоинт проверки учётных данных | `login` |

## Карта функций
| Имя | Видимость | Сигнатура | Краткое назначение | Исключения | Сайд‑эффекты |
|---|---|---|---|---|---|
| `login_required` | public | `login_required(f)` | Проверяет наличие пользователя в сессии | нет | `redirect` при отсутствии пользователя |
| `index` | public | `index()` | Перенаправляет на логин или рабочую страницу | нет | `redirect` |
| `login` | public | `login()` | Обрабатывает форму логина и обращается к API | нет | HTTP-запрос, запись в сессию |
| `logout` | public | `logout()` | Удаляет пользователя из сессии | нет | Изменение сессии, `redirect` |
| `work` | public | `work()` | Возвращает шаблон рабочей страницы | нет | нет |

## Описание функций
### `login_required`
**Назначение.** Декоратор, ограничивающий доступ к представлению пользователем с активной сессией.
**Параметры.** `f: Callable` — функция представления.
**Возвращает.** Обёрнутую функцию.
**Исключения.** нет.
**Сайд‑эффекты.** Перенаправление на `/login`.
**Локальные переменные.**
- `decorated: Callable` — обёртка, выполняющая проверку сессии.

### `index`
**Назначение.** Начальная страница, перенаправляющая на логин или рабочую область.
**Параметры.** нет.
**Возвращает.** Ответ с редиректом.
**Исключения.** нет.
**Сайд‑эффекты.** Перенаправление пользователя.
**Локальные переменные.** нет.

### `login`
**Назначение.** Авторизация пользователя через сервис "Мой Склад".
**Параметры.** нет (данные формы берутся из `request`).
**Возвращает.** HTML-страницу или редирект на `/work`.
**Исключения.** нет.
**Сайд‑эффекты.** HTTP-запрос к `MY_SKLAD_URL`, изменение сессии.
**Локальные переменные.**
- `username: str` — логин из формы.
- `password: str` — пароль из формы.
- `resp: Response` — ответ сервиса `requests.get`.
- `error: str` — сообщение об ошибке для шаблона.

### `logout`
**Назначение.** Завершает пользовательскую сессию.
**Параметры.** нет.
**Возвращает.** Редирект на `/login`.
**Исключения.** нет.
**Сайд‑эффекты.** Удаление данных из сессии.
**Локальные переменные.** нет.

### `work`
**Назначение.** Отображает рабочую страницу.
**Параметры.** нет.
**Возвращает.** HTML-шаблон `work.html`.
**Исключения.** нет.
**Сайд‑эффекты.** нет.
**Локальные переменные.** нет.

## Описание исполнительной части кода
- Действия при импорте: создаётся приложение Flask, настраивается `ProxyFix`, регистрируются маршруты.
- CLI/entrypoints: при запуске файла напрямую выполняется `app.run(...)`.
- Типичный вызов:
  1. Запустить модуль командой `python app.py`.
  2. Открыть страницу `/login` в браузере.
  3. Ввести логин и пароль для авторизации.
  4. После успешного входа перейти на `/work`.
