# ms_api.php

Общая функция для запросов к API МойСклад.
При подключении файла автоматически устанавливается заголовок
`Content-Type: application/json; charset=utf-8`.
В случае ошибок выводится JSON с полем `error` и кодом ответа `500`.
Если API возвращает код ошибки `1061`, функция бросает исключение с сообщением `no_api_access`.
Каждый выполненный запрос дополнительно отправляется в `log_request.php`
для сохранения информации о времени ответа, коде статуса
и теле ошибки (если оно присутствует). При сбое HTTP-отправки данные
журнала записываются напрямую через функцию `ms_write_log()`.

Для повторного использования соединения добавлены функции `ms_api_connect()`
и `ms_api_close()`. Они позволяют открыть cURL-сессию один раз и выполнять
несколько запросов подряд без повторного создания ресурса.

## Зависимости
- PHP с поддержкой cURL

## Параметры
- `$endpoint` — URL запроса
- `$login` и `$password` — данные авторизации (необязательные, по умолчанию берутся из сессии)
- `$method` — HTTP-метод (`GET`, `POST`, ...)
- `$payload` — массив данных, который будет закодирован в JSON и отправлен в теле запроса

## Возвращаемые данные
- Ассоциативный массив ответа API

Файл скрипта: `api_ms/ms_api.php`.
